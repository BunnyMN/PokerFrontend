(()=>{var e={};e.id=684,e.ids=[684],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},6422:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>l.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>d}),t(4401),t(5804),t(5866);var a=t(3191),s=t(8716),n=t(7922),l=t.n(n),i=t(5231),o={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>i[e]);t.d(r,o);let d=["",{children:["room",{children:["[roomId]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,4401)),"/Users/bayartsogtbts/Desktop/Gerege Agent AI/Pp/poker_frontend/app/room/[roomId]/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,5804)),"/Users/bayartsogtbts/Desktop/Gerege Agent AI/Pp/poker_frontend/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,5866,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/bayartsogtbts/Desktop/Gerege Agent AI/Pp/poker_frontend/app/room/[roomId]/page.tsx"],u="/room/[roomId]/page",m={require:t,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/room/[roomId]/page",pathname:"/room/[roomId]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},9030:(e,r,t)=>{Promise.resolve().then(t.bind(t,6184))},4354:(e,r,t)=>{Promise.resolve().then(t.t.bind(t,2994,23)),Promise.resolve().then(t.t.bind(t,6114,23)),Promise.resolve().then(t.t.bind(t,9727,23)),Promise.resolve().then(t.t.bind(t,9671,23)),Promise.resolve().then(t.t.bind(t,1868,23)),Promise.resolve().then(t.t.bind(t,4759,23))},5529:(e,r,t)=>{Promise.resolve().then(t.bind(t,6536)),Promise.resolve().then(t.bind(t,7087))},6184:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>W});var a=t(326),s=t(7577),n=t(9065),l=t(1100);let i="https://watbrrrtsruvotjisvkp.supabase.co",o="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndhdGJycnJ0c3J1dm90amlzdmtwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4Njc0NDQsImV4cCI6MjA4MTQ0MzQ0NH0.s3n81p9aX5cyWbOuPwoKjqLOW7X2nuJQBtxGz1sV3eQ";if(!i||!o)throw console.error("Missing Supabase environment variables:",{hasNextPublicUrl:!0,hasViteUrl:!!process.env.VITE_SUPABASE_URL,hasNextPublicKey:!0,hasViteKey:!!process.env.VITE_SUPABASE_ANON_KEY}),Error("Missing Supabase environment variables. Please check your .env.local file.");let d=(0,l.AY)(i,o),c=(...e)=>{},u=(...e)=>{},m=(...e)=>{console.error(...e)},p=()=>{let e="ws:localhost:4000/ws";if(!e)throw Error("NEXT_PUBLIC_GAME_SERVER_WS_URL or VITE_GAME_SERVER_WS_URL environment variable is not set");return e};function x(e){let r;return"object"!=typeof e||null===e?{suit:"S",rank:"3"}:("number"==typeof e.suit?r=({0:"S",1:"H",2:"C",3:"D"})[e.suit]||"S":"string"==typeof e.suit&&["S","H","C","D"].includes(r=({"♠":"S","♥":"H","♣":"C","♦":"D"})[e.suit]||e.suit)||(r="S"),{suit:r,rank:"number"==typeof e.rank?({3:"3",4:"4",5:"5",6:"6",7:"7",8:"8",9:"9",10:"10",11:"J",12:"Q",13:"K",14:"A",15:"2"})[e.rank]||"3":"string"==typeof e.rank&&["3","4","5","6","7","8","9","10","J","Q","K","A","2"].includes(e.rank)?e.rank:"3"})}function g(e){return({3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,J:11,Q:12,K:13,A:14,2:15})[e]||0}function y(e){return({D:0,C:1,H:2,S:3})[e]||0}function h(e){return[...e].sort((e,r)=>{let t=g(e.rank)-g(r.rank);return 0!==t?t:y(e.suit)-y(r.suit)})}function f(e,r){return e.rank===r.rank&&e.suit===r.suit}function b(...e){return e.filter(Boolean).join(" ")}function v({className:e,variant:r="default",size:t="md",children:s,...n}){return a.jsx("span",{className:b("inline-flex items-center font-semibold rounded-md backdrop-blur-sm",{default:"glass border border-cyan-400/40 text-cyan-300",primary:"bg-cyan-900/50 border border-cyan-400/60 text-cyan-300 shadow-neon-cyan",success:"bg-lime-900/50 border border-lime-400/60 text-lime-300 shadow-neon-lime",danger:"bg-pink-900/50 border border-pink-400/60 text-pink-300 shadow-neon-magenta",warning:"bg-purple-900/50 border border-purple-400/60 text-purple-300 shadow-neon-purple",info:"bg-cyan-900/50 border border-cyan-400/60 text-cyan-300 shadow-neon-cyan"}[r],{sm:"px-2 py-0.5 text-xs font-heading",md:"px-2.5 py-1 text-sm font-heading"}[t],e),...n,children:s})}let S=(0,s.memo)(function({playerId:e,playerName:r,playerAvatar:t,cardsLeft:s,totalScore:n,scoreLimit:l,isCurrentTurn:i,isEliminated:o,isYou:d}){let c=e.length>8?e.substring(0,8)+"...":e,u=r||c,m=u.trim().charAt(0).toUpperCase()||"?",p=n/l*100;return(0,a.jsxs)("div",{className:b("relative glass rounded-xl border-2 text-center transition-all duration-300","hover:scale-105 hover:shadow-glow-cyan","w-36 p-4",i?"border-cyan-400 shadow-glow-cyan ring-2 ring-cyan-400/50 animate-pulse-glow":"border-cyan-500/30",o&&"opacity-50 border-pink-500/50 bg-pink-900/20",d&&!i&&"border-lime-400/40"),children:[a.jsx("div",{className:"relative mb-3",children:(0,a.jsxs)("div",{className:b("w-16 h-16 mx-auto rounded-full border-2 flex items-center justify-center overflow-hidden","glass-lg",i?"border-cyan-400 shadow-glow-cyan":d?"border-lime-400/60 shadow-neon-lime":"border-cyan-500/40",o&&"border-pink-500/50"),children:[t?a.jsx("img",{src:t,alt:u,className:"w-full h-full object-cover",onError:e=>{let r=e.target;r.style.display="none";let t=r.parentElement;t&&(t.innerHTML=`<div class="w-full h-full flex items-center justify-center ${i?"text-cyan-300 text-glow-cyan":"text-cyan-400"} ${o?"text-pink-400":""} text-2xl font-bold font-heading">${m}</div>`)}}):a.jsx("div",{className:b("text-2xl font-bold font-heading",i?"text-cyan-300 text-glow-cyan":"text-cyan-400",o&&"text-pink-400"),children:m}),i&&a.jsx("div",{className:"absolute inset-0 rounded-full border-2 border-cyan-400 animate-ping opacity-75"})]})}),(0,a.jsxs)("div",{className:"font-heading font-semibold text-sm mb-2",children:[a.jsx("div",{className:b("truncate",i?"text-cyan-300 text-glow-cyan":"text-white",o&&"text-pink-400"),children:u}),d&&a.jsx("span",{className:"ml-1 text-xs text-lime-400 text-glow-lime font-medium",children:"(YOU)"})]}),(0,a.jsxs)("div",{className:"space-y-2 text-xs",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-cyan-400/80",children:"Cards:"}),a.jsx("span",{className:"font-bold text-cyan-300",children:s})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[a.jsx("span",{className:"text-cyan-400/80",children:"Score:"}),(0,a.jsxs)("span",{className:b("font-bold",p>=80?"text-pink-400":p>=50?"text-yellow-400":"text-lime-400"),children:[n," / ",l]})]}),a.jsx("div",{className:"h-1.5 bg-cyan-900/30 rounded-full overflow-hidden",children:a.jsx("div",{className:b("h-full transition-all duration-300 rounded-full",p>=80?"bg-gradient-to-r from-pink-500 to-pink-600 shadow-neon-magenta":p>=50?"bg-gradient-to-r from-yellow-400 to-yellow-500":"bg-gradient-to-r from-lime-400 to-lime-500 shadow-neon-lime"),style:{width:`${Math.min(p,100)}%`}})})]})]}),i&&a.jsx(v,{variant:"warning",size:"sm",className:"absolute -top-2 -right-2 shadow-lg border-cyan-400 bg-cyan-900/50 text-cyan-300 font-heading",children:"TURN"}),o&&a.jsx(v,{variant:"danger",size:"sm",className:"absolute -top-2 -left-2 shadow-lg border-pink-400 bg-pink-900/50 text-pink-300 font-heading",children:"ELIM"})]})}),j={S:"text-black",H:"text-red-600",C:"text-black",D:"text-red-600"},N=(0,s.memo)(function({card:e,isSelected:r=!1,onClick:t,size:s="md",className:n,isBack:l=!1}){let i={sm:"w-12 h-16 text-xs",md:"w-16 h-24 text-sm",lg:"w-20 h-32 text-base"},o={S:"♠",H:"♥",C:"♣",D:"♦"}[e.suit],d=j[e.suit]||"text-black";return l?(0,a.jsxs)("div",{className:b("relative bg-white rounded-lg border-2 border-gray-300 cursor-pointer transition-all duration-300","hover:scale-110 hover:border-gray-400",i[s],n),onClick:t,children:[a.jsx("div",{className:"absolute inset-0 opacity-10",children:a.jsx("div",{className:"absolute inset-0",style:{backgroundImage:`
              repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0, 0, 0, 0.1) 2px, rgba(0, 0, 0, 0.1) 4px),
              repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(0, 0, 0, 0.1) 2px, rgba(0, 0, 0, 0.1) 4px)
            `}})}),a.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:a.jsx("div",{className:"text-black text-2xl font-bold",children:"♠"})})]}):a.jsx("div",{className:b("relative bg-white rounded-lg border-2 border-gray-300 transition-all duration-300 cursor-pointer","hover:scale-110 hover:-translate-y-2 hover:border-gray-400 hover:shadow-xl",r?"scale-110 -translate-y-2 border-blue-500 ring-2 ring-blue-400/50 shadow-xl":"hover:border-gray-400",i[s],n),onClick:t,children:(0,a.jsxs)("div",{className:"absolute inset-0 p-2 flex flex-col justify-between",children:[a.jsx("div",{className:b("font-bold",d),children:a.jsx("div",{className:"leading-tight",children:e.rank})}),a.jsx("div",{className:b("absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-xl",d),children:o}),a.jsx("div",{className:b("font-bold self-end rotate-180",d),children:a.jsx("div",{className:"leading-tight",children:e.rank})})]})})}),w=(0,s.memo)(function({seatedPlayerIds:e,handsCount:r,totalScores:t,scoreLimit:n,currentTurnPlayerId:l,eliminated:i,currentUserId:o,lastPlay:d,playerNames:c,playerAvatars:u}){let m=e.length,p=(0,s.useMemo)(()=>0===m?[]:e.map((e,r)=>{let t=Math.PI/180*(270+360*r/m);return{x:250+200*Math.cos(t),y:250+200*Math.sin(t),angle:180/Math.PI*t}}),[e,m]);if(0===m)return null;let g=e=>p[e];return a.jsx("div",{className:"flex justify-center items-center p-6 min-h-[600px] relative",children:(0,a.jsxs)("div",{className:"relative w-[500px] h-[500px]",children:[(0,a.jsxs)("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[400px] h-[400px] rounded-full",children:[a.jsx("div",{className:"absolute inset-0 rounded-full bg-gradient-to-br from-purple-900/20 via-cyan-900/20 to-pink-900/20 animate-pulse-glow"}),(0,a.jsxs)("div",{className:"absolute inset-2 rounded-full",style:{background:"radial-gradient(circle at 30% 30%, rgba(157, 0, 255, 0.3) 0%, rgba(10, 0, 21, 0.9) 50%, #0a0015 100%)",border:"2px solid rgba(0, 246, 255, 0.3)"},children:[a.jsx("div",{className:"absolute inset-0 rounded-full border-2 border-cyan-400/40 shadow-[0_0_20px_rgba(0,246,255,0.3)]"}),a.jsx("div",{className:"absolute inset-0 rounded-full opacity-10",style:{backgroundImage:`
                  repeating-linear-gradient(0deg, transparent, transparent 20px, rgba(0, 246, 255, 0.1) 20px, rgba(0, 246, 255, 0.1) 21px),
                  repeating-linear-gradient(90deg, transparent, transparent 20px, rgba(0, 246, 255, 0.1) 20px, rgba(0, 246, 255, 0.1) 21px)
                `}})]}),a.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-cyan-400/60 shadow-[0_0_30px_rgba(0,246,255,0.5),inset_0_0_30px_rgba(0,246,255,0.2)] animate-glow-pulse"})]}),d&&(0,a.jsxs)("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 z-20 glass-lg rounded-xl border border-cyan-400/50 p-4 min-w-[200px] text-center shadow-glow-cyan",children:[a.jsx("div",{className:"text-xs text-cyan-400/80 mb-2 font-heading uppercase tracking-wider",children:"Last Play"}),a.jsx("div",{className:"text-sm font-bold text-cyan-300 mb-3 font-heading text-glow-cyan",children:(()=>{let e=d.cards.length,r=d.kind;return(r||(r=1===e?"SINGLE":2===e?"PAIR":3===e?"SET":5===e?"FIVE":"PLAY"),"FIVE"===r&&d.fiveKind)?`${r} (${d.fiveKind})`:r})()}),a.jsx("div",{className:"flex gap-2 justify-center flex-wrap",children:d.cards.map((e,r)=>{let t=x(e);return a.jsx(N,{card:t,size:"sm",className:"pointer-events-none"},r)})})]}),e.map((e,s)=>{let d=g(s);return a.jsx("div",{className:"absolute z-10",style:{left:`${d.x}px`,top:`${d.y}px`,transform:"translate(-50%, -50%)"},children:a.jsx(S,{playerId:e,playerName:c?.[e],playerAvatar:u?.[e]||null,cardsLeft:r[e]||0,totalScore:t[e]||0,scoreLimit:n,isCurrentTurn:e===l,isEliminated:i.includes(e),isYou:e===o})},e)})]})})});function k({className:e,header:r,footer:t,children:s,...n}){return(0,a.jsxs)("div",{className:b("glass rounded-xl border border-white/10","hover:border-cyan-400/30 hover:bg-white/5 transition-all duration-200",e),...n,children:[r&&a.jsx("div",{className:"px-6 py-4 border-b border-white/10",children:r}),a.jsx("div",{className:b(r||t?"px-6 py-4":"p-6"),children:s}),t&&a.jsx("div",{className:"px-6 py-4 border-t border-white/10",children:t})]})}function E({queuePlayerIds:e,seatedPlayerIds:r,handsCount:t,totalScores:s,scoreLimit:n,currentTurnPlayerId:l,eliminated:i,playerNames:o}){let d=e=>e.length>6?e.substring(0,6)+"...":e,c=e=>o?.[e]||d(e);return a.jsx(k,{className:"w-full max-w-sm",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-[var(--text)] mb-3",children:"Queue"}),0===e.length?a.jsx("p",{className:"text-sm text-[var(--text-muted)] italic",children:"No players in queue"}):a.jsx("div",{className:"space-y-2",children:e.map((e,r)=>(0,a.jsxs)("div",{className:b("flex items-center gap-3 p-3 rounded-lg border border-[var(--border)]","bg-[var(--bg-elevated)] hover:bg-[var(--surface-hover)] transition-colors"),children:[(0,a.jsxs)("span",{className:"text-sm font-semibold text-[var(--text-muted)] w-6",children:[r+1,"."]}),a.jsx("span",{className:"flex-1 text-sm text-[var(--text)] font-medium",children:c(e)}),(0,a.jsxs)("span",{className:"text-xs text-[var(--text-muted)]",children:[s[e]||0," / ",n]}),i.includes(e)&&a.jsx(v,{variant:"danger",size:"sm",children:"ELIM"})]},e))})]}),(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-[var(--text)] mb-3",children:"Seated Scores"}),0===r.length?a.jsx("p",{className:"text-sm text-[var(--text-muted)] italic",children:"No players seated"}):(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"grid grid-cols-[2fr_1fr_1.5fr_1fr] gap-3 px-3 py-2 bg-[var(--bg-elevated)] rounded-lg text-xs font-semibold text-[var(--text-muted)]",children:[a.jsx("div",{children:"Player"}),a.jsx("div",{children:"Cards"}),a.jsx("div",{children:"Score"}),a.jsx("div",{children:"Turn"})]}),r.map(e=>(0,a.jsxs)("div",{className:b("grid grid-cols-[2fr_1fr_1.5fr_1fr] gap-3 px-3 py-2 rounded-lg","border border-[var(--border)] bg-[var(--bg-elevated)]","hover:bg-[var(--surface-hover)] transition-colors",i.includes(e)&&"opacity-60 bg-[var(--danger-bg)]"),children:[a.jsx("div",{className:"text-sm text-[var(--text)] font-medium truncate",children:c(e)}),a.jsx("div",{className:"text-sm text-[var(--text-muted)]",children:t[e]||0}),(0,a.jsxs)("div",{className:"text-sm text-[var(--text-muted)]",children:[s[e]||0," / ",n]}),a.jsx("div",{className:"flex items-center",children:e===l?a.jsx("span",{className:"text-[var(--warning)] text-lg font-bold",children:"●"}):a.jsx("span",{className:"text-[var(--text-muted)] text-lg",children:"○"})})]},e))]})]})]})})}let R=(0,s.forwardRef)(({className:e,variant:r="primary",size:t="md",isLoading:s,children:n,disabled:l,...i},o)=>(0,a.jsxs)("button",{ref:o,className:b("inline-flex items-center justify-center font-heading font-semibold transition-all duration-300 rounded-lg focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-offset-cyber-bg focus-visible:ring-cyan-400 disabled:opacity-50 disabled:cursor-not-allowed relative overflow-hidden",{primary:"glass border-2 border-cyan-400/60 text-cyan-300 hover:border-cyan-400 hover:text-cyan-200 hover:shadow-glow-cyan active:scale-95",secondary:"glass border-2 border-cyan-500/40 text-white hover:border-cyan-400/60 hover:shadow-neon-cyan active:scale-95",ghost:"text-cyan-400 hover:text-cyan-300 hover:bg-cyan-900/20 border border-transparent hover:border-cyan-400/30 active:scale-95",danger:"glass border-2 border-pink-500/60 text-pink-300 hover:border-pink-400 hover:text-pink-200 hover:shadow-glow-magenta active:scale-95",success:"glass border-2 border-lime-400/60 text-lime-300 hover:border-lime-400 hover:text-lime-200 hover:shadow-glow-lime active:scale-95",warning:"glass border-2 border-purple-400/60 text-purple-300 hover:border-purple-400 hover:text-purple-200 hover:shadow-glow-purple active:scale-95"}[r],{sm:"px-3 py-1.5 text-xs h-8",md:"px-4 py-2 text-sm h-10",lg:"px-6 py-3 text-base h-12"}[t],e),disabled:l||s,...i,children:[a.jsx("div",{className:"absolute inset-0 opacity-0 hover:opacity-100 transition-opacity duration-300",children:a.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-cyan-400/20 to-transparent transform -skew-x-12 animate-scanline"})}),a.jsx("span",{className:"relative z-10",children:s?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 inline",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[a.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),a.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Loading..."]}):n})]}));function I({children:e,showSignOut:r=!0,userEmail:t}){let s=(0,n.s0)(),l=async()=>{await d.auth.signOut(),s("/auth")};return(0,a.jsxs)("div",{className:"min-h-screen bg-[var(--bg)]",children:[a.jsx("header",{className:"sticky top-0 z-[var(--z-sticky)] border-b border-[var(--border)] bg-[var(--bg-surface)] backdrop-blur-sm",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex items-center justify-between h-20",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[a.jsx("h1",{className:"text-3xl font-bold text-[var(--text)]",children:"Game Lobby"}),t&&(0,a.jsxs)("p",{className:"text-sm text-[var(--text)]",children:["Welcome, ",t]})]}),r&&(0,a.jsxs)(R,{variant:"ghost",size:"md",onClick:l,className:"border border-[var(--danger)] text-[var(--text)] hover:bg-[var(--danger-bg)]",children:[a.jsx("svg",{className:"w-4 h-4 mr-2 text-[var(--danger)]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),"Sign Out"]})]})})}),a.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e})]})}R.displayName="Button";let _=0,P=[],A=[],C={show:(e,r="info",t)=>{let a=`toast-${++_}`;return P.push({id:a,message:e,type:r,duration:t}),A.forEach(e=>e([...P])),a},success:(e,r)=>C.show(e,"success",r),error:(e,r)=>C.show(e,"error",r),info:(e,r)=>C.show(e,"info",r),warning:(e,r)=>C.show(e,"warning",r)};function T({className:e,variant:r="rectangular",...t}){return a.jsx("div",{className:b("animate-pulse bg-[var(--surface)]",{text:"h-4 rounded",circular:"rounded-full",rectangular:"rounded-lg"}[r],e),...t})}function O(){let{roomId:e}=(0,n.UO)(),r=(0,n.s0)(),[t,l]=(0,s.useState)(null),[i,o]=(0,s.useState)([]),[g,y]=(0,s.useState)(null),[S,j]=(0,s.useState)(!0),[_,P]=(0,s.useState)(null),[A,O]=(0,s.useState)(!1),[W,L]=(0,s.useState)(!1),[U,D]=(0,s.useState)(!1),[M,Y]=(0,s.useState)("disconnected"),[F,z]=(0,s.useState)([]),[$,G]=(0,s.useState)(null),Q=(0,s.useRef)(null),q=(0,s.useRef)(!1),[J,H]=(0,s.useState)([]),[B,K]=(0,s.useState)(""),V=(0,s.useRef)(!0),X=(0,s.useRef)(0);(0,s.useRef)(null),(0,s.useRef)(null),(0,s.useRef)(!1);let[Z,ee]=(0,s.useState)([]),[er,et]=(0,s.useState)(null),[ea,es]=(0,s.useState)(null),[en,el]=(0,s.useState)([]),[ei,eo]=(0,s.useState)(null),ed=(0,s.useRef)(null),[ec,eu]=(0,s.useState)(null),[em,ep]=(0,s.useState)(null),[ex,eg]=(0,s.useState)([]),[ey,eh]=(0,s.useState)([]),[ef,eb]=(0,s.useState)([]),[ev,eS]=(0,s.useState)(null),[ej,eN]=(0,s.useState)(null),[ew,ek]=(0,s.useState)({}),[eE,eR]=(0,s.useState)(null),[eI,e_]=(0,s.useState)(!1),[eP,eA]=(0,s.useState)([]),[eC,eT]=(0,s.useState)(null),[eO,eW]=(0,s.useState)(60),[eL,eU]=(0,s.useState)([]),[eD,eM]=(0,s.useState)(60),[eY,eF]=(0,s.useState)({}),[ez,e$]=(0,s.useState)([]),eG=(0,s.useCallback)(e=>{let r=i.find(r=>r.player_id===e);return r?.profile?.display_name?r.profile.display_name:e.length>8?`${e.substring(0,8)}...`:e},[i]),eQ=(0,s.useMemo)(()=>{let e={};return i.forEach(r=>{let t=r.profile?.display_name||"";t&&(e[r.player_id]=t)}),e},[i]),eq=(0,s.useMemo)(()=>{let e={};return i.forEach(r=>{r.profile?.avatar_url&&(e[r.player_id]=r.profile.avatar_url)}),e},[i]),eJ=(0,s.useCallback)(async(r,a)=>{if("playing"!==r){V.current=!1;return}if(V.current=!0,Q.current){let e=Q.current.readyState;if(e===WebSocket.OPEN){c("[AutoConnect] Already connected, skipping");return}if(e===WebSocket.CONNECTING){c("[AutoConnect] Already connecting, skipping");return}(e===WebSocket.CLOSING||e===WebSocket.CLOSED)&&(Q.current.close(),Q.current=null)}if(q.current){c("[AutoConnect] Connection in progress (flag), skipping");return}c("[AutoConnect] room.status is playing");try{let{data:{session:r}}=await d.auth.getSession(),s=!!r?.access_token;if(c("[AutoConnect] token present?",s),!r?.access_token){c("[AutoConnect] No access token available"),G("No access token available"),Y("error");return}c("[AutoConnect] creating WS"),q.current=!0,Y("connecting"),G(null),K("ws:localhost:4000/ws");let n=function(e,r,t,a,s){let n=p(),l=(e,r)=>{let t={timestamp:Date.now(),event:e,data:r};c(`[WS] ${e}`,void 0!==r?r:""),s&&s(t)};l("creating socket",{url:n});let i=new WebSocket(n),o=!1,d=null,u=!1;return d=setTimeout(()=>{i.readyState===WebSocket.OPEN||o||(l("open timeout - WS_OPEN_TIMEOUT",{readyState:i.readyState}),t({type:"WS_OPEN_TIMEOUT",error:"WebSocket open event did not fire within 5 seconds"}),i.close())},5e3),i.onopen=()=>{d&&(clearTimeout(d),d=null),l("open");try{i.send(JSON.stringify({type:"HELLO",roomId:e,accessToken:r})),o=!0,l("HELLO sent successfully")}catch(e){m("[WS] Failed to send HELLO message:",e),t({type:"WS_ERROR",error:"Failed to send HELLO message",details:e instanceof Error?e.message:String(e)})}},i.sendSyncRequest=()=>{if(i.readyState===WebSocket.OPEN)try{i.send(JSON.stringify({type:"SYNC_REQUEST",roomId:e})),l("SYNC_REQUEST sent")}catch(e){m("[WS] Failed to send SYNC_REQUEST:",e)}},i.onmessage=e=>{l("message received",{dataLength:e.data?.length||0});try{let r=JSON.parse(e.data);l("message parsed",{type:r.type}),"ERROR"===r.type&&m("[WS] Server ERROR message:",r),t(r)}catch(r){m("[WS] Failed to parse WebSocket message:",r),t({type:"PARSE_ERROR",error:"Failed to parse message",parseError:r instanceof Error?r.message:String(r),raw:e.data})}},i.onerror=e=>{m("[WS] WebSocket error event:",e),t({type:"WS_ERROR",error:"WebSocket connection error",details:e instanceof Error?e.message:String(e)})},i.onclose=e=>{d&&(clearTimeout(d),d=null),l("close",{code:e.code,reason:e.reason,wasClean:e.wasClean,manualClose:u}),a&&a(e.code,e.reason,e.wasClean)},i.markManualClose=()=>{u=!0},i}(a,r.access_token,r=>{if(c("[WS] message handler received",r.type),"ERROR"===r.type){let e="string"==typeof r.error?r.error:"string"==typeof r.message?r.message:"object"==typeof r.error&&null!==r.error&&"message"in r.error?String(r.error.message||"Server error"):"Server error";m("[WS] Server ERROR:",e),G(e),Y("error")}else if("WELCOME"===r.type)c("[WS] Received WELCOME"),c("[AutoConnect] WS connected because room is playing"),Y("connected"),G(null),q.current=!1,X.current=0,setTimeout(()=>{let r=a||e;if(Q.current&&Q.current.readyState===WebSocket.OPEN&&r)try{if(!r||"string"!=typeof r||""===r.trim()){m("[WS] Cannot send SYNC_REQUEST: Invalid roomId",{roomId:r,type:typeof r,fromParams:e,fromConnect:a});return}let t={type:"SYNC_REQUEST",roomId:r.trim()};c("[WS] Sending SYNC_REQUEST:",t);let s=JSON.stringify(t);c("[WS] SYNC_REQUEST JSON:",s),Q.current.send(s),c("[WS] SYNC_REQUEST sent")}catch(e){m("[WS] Failed to send SYNC_REQUEST:",e)}else m("[WS] Cannot send SYNC_REQUEST:",{wsReady:Q.current?.readyState===WebSocket.OPEN,roomId:r,roomIdFromParams:e,roomIdFromConnect:a})},100);else if("STATE"===r.type)c("[WS] Received STATE"),c("[AutoConnect] WS connected because room is playing"),Y("connected"),G(null),q.current=!1,X.current=0,setTimeout(()=>{let r=a||e;if(Q.current&&Q.current.readyState===WebSocket.OPEN&&r)try{if(!r||"string"!=typeof r||""===r.trim()){m("[WS] Cannot send SYNC_REQUEST (after STATE): Invalid roomId",{roomId:r,type:typeof r,fromParams:e,fromConnect:a});return}let t={type:"SYNC_REQUEST",roomId:r.trim()};c("[WS] Sending SYNC_REQUEST (after STATE):",t);let s=JSON.stringify(t);c("[WS] SYNC_REQUEST JSON (after STATE):",s),Q.current.send(s),c("[WS] SYNC_REQUEST sent (after STATE)")}catch(e){m("[WS] Failed to send SYNC_REQUEST:",e)}else m("[WS] Cannot send SYNC_REQUEST (after STATE):",{wsReady:Q.current?.readyState===WebSocket.OPEN,roomId:r,roomIdFromParams:e,roomIdFromConnect:a})},100);else if("SYNC_STATE"===r.type){if(c("[WS] Received SYNC_STATE"),eo(null),ed.current=null,r.seatedPlayerIds&&Array.isArray(r.seatedPlayerIds)&&eg(r.seatedPlayerIds),r.queuePlayerIds&&Array.isArray(r.queuePlayerIds)&&eh(r.queuePlayerIds),r.currentTurnPlayerId&&"string"==typeof r.currentTurnPlayerId&&eS(r.currentTurnPlayerId),r.lastPlay&&"object"==typeof r.lastPlay&&null!==r.lastPlay){let e=r.lastPlay,t={playerId:"string"==typeof e.playerId?e.playerId:"",cards:Array.isArray(e.cards)?e.cards.map(e=>x(e)):[],kind:"string"==typeof e.kind?e.kind:void 0,fiveKind:"string"==typeof e.fiveKind?e.fiveKind:void 0};eN(t)}else eN(null);if(r.handsCount&&"object"==typeof r.handsCount&&null!==r.handsCount){let e={};for(let[t,a]of Object.entries(r.handsCount))e[t]="number"==typeof a?a:0;ek(e)}if(r.totalScores&&"object"==typeof r.totalScores){let e={};for(let[t,a]of Object.entries(r.totalScores))e[t]="number"==typeof a?a:0;eF(e)}if(r.eliminated&&Array.isArray(r.eliminated)&&e$(r.eliminated),r.yourHand&&Array.isArray(r.yourHand)){let e=r.yourHand.map(e=>x(e)),t=h(e);es(t),el([])}"number"==typeof r.scoreLimit&&eW(r.scoreLimit)}else if("ROOM_STATE"===r.type){if(c("[WS] Received ROOM_STATE"),r.players&&Array.isArray(r.players)){let t=r.players;ee(t.map(e=>({playerId:e.playerId,isReady:e.isReady??!1}))),o(r=>{let a=t.map(e=>e.playerId),s=new Set(r.map(e=>e.player_id)),n=a.filter(e=>!s.has(e));return n.length>0&&e&&Promise.all(n.map(async r=>{try{let{data:a}=await d.from("profiles").select("id, display_name, avatar_url").eq("id",r).single();a&&o(s=>s.find(e=>e.player_id===r)?s.map(e=>e.player_id===r?{...e,profile:a}:e):[...s,{player_id:r,room_id:e,is_ready:t.find(e=>e.playerId===r)?.isReady||!1,left_at:null,joined_at:new Date().toISOString(),id:"",profile:a}])}catch(e){u(`Failed to fetch profile for player ${r}:`,e)}})).catch(e=>{u("Failed to fetch profiles for new players:",e)}),r})}}else if("ROUND_START"===r.type)c("[WS] Received ROUND_START"),r.roomId&&"string"==typeof r.roomId&&r.startedAt&&"string"==typeof r.startedAt&&et({roomId:r.roomId,startedAt:r.startedAt});else if("RULES"===r.type)c("[WS] Received RULES"),"number"==typeof r.scoreLimit&&(eW(r.scoreLimit),eM(r.scoreLimit));else if("SCORE_UPDATE"===r.type){if(c("[WS] Received SCORE_UPDATE"),r.totalScores&&"object"==typeof r.totalScores){let e=[],t={};for(let[a,s]of Object.entries(r.totalScores)){let n="number"==typeof s?s:0;t[a]=n,e.push({playerId:a,totalScore:n,eliminated:!!(r.eliminated&&Array.isArray(r.eliminated))&&r.eliminated.includes(a)})}eF(t),eU(e),r.eliminated&&Array.isArray(r.eliminated)&&e$(r.eliminated)}}else if("DEALT"===r.type){if(c("[WS] Received DEALT"),eT(null),eo(null),ed.current=null,r.yourHand&&Array.isArray(r.yourHand)){let e=r.yourHand.map(e=>x(e)),t=h(e);es(t),eb([]),el([])}r.starterPlayerId&&"string"==typeof r.starterPlayerId&&eu(r.starterPlayerId),r.reason&&"string"==typeof r.reason&&ep(r.reason),r.seatedPlayerIds&&Array.isArray(r.seatedPlayerIds)&&eg(r.seatedPlayerIds)}else if("GAME_STATE"===r.type){if(c("[WS] Received GAME_STATE"),r.currentTurnPlayerId&&"string"==typeof r.currentTurnPlayerId&&eS(r.currentTurnPlayerId),r.lastPlay&&"object"==typeof r.lastPlay&&null!==r.lastPlay){let e=r.lastPlay,t={playerId:"string"==typeof e.playerId?e.playerId:"",cards:Array.isArray(e.cards)?e.cards.map(e=>x(e)):[],kind:"string"==typeof e.kind?e.kind:void 0,fiveKind:"string"==typeof e.fiveKind?e.fiveKind:void 0};eN(t),t.playerId===g&&ed.current&&(c("[WS] Play successful, clearing pending cards"),eo(null),ed.current=null)}else eN(null);if(eb([]),r.handsCount&&"object"==typeof r.handsCount&&null!==r.handsCount){let e={};for(let[t,a]of Object.entries(r.handsCount))e[t]="number"==typeof a?a:0;ek(e)}if("boolean"==typeof r.canPass&&e_(r.canPass),r.passedPlayerIds&&Array.isArray(r.passedPlayerIds)?eA(r.passedPlayerIds):eA([]),r.queuePlayerIds&&Array.isArray(r.queuePlayerIds)&&eh(r.queuePlayerIds),r.totalScores&&"object"==typeof r.totalScores){let e={};for(let[t,a]of Object.entries(r.totalScores))e[t]="number"==typeof a?a:0;eF(e)}r.eliminated&&Array.isArray(r.eliminated)&&e$(r.eliminated)}else if("ACTION_ERROR"===r.type){let e="string"==typeof r.error?r.error:"string"==typeof r.message?r.message:"object"==typeof r.error&&null!==r.error&&"message"in r.error?String(r.error.message||"Action error"):"Action error";m("[WS] Received ACTION_ERROR:",e),eR(e);let t=ed.current;t&&t.length>0&&(c("[WS] Restoring cards after ACTION_ERROR:",t),es(e=>{if(!e)return e;let r=[...e,...t];return h(r)}),el([]),eo(null),ed.current=null),setTimeout(()=>eR(null),5e3)}else if("ROUND_END"===r.type)c("[WS] Received ROUND_END"),r.winnerPlayerId&&"string"==typeof r.winnerPlayerId&&eT({winnerPlayerId:r.winnerPlayerId});else if("WS_ERROR"===r.type||"PARSE_ERROR"===r.type){let e="string"==typeof r.error?r.error:"object"==typeof r.error&&null!==r.error&&"message"in r.error?String(r.error.message||"WebSocket error"):"WebSocket error";m("[WS] Client error:",e),G(e),Y("error"),q.current=!1}else if("WS_OPEN_TIMEOUT"===r.type){let e="string"==typeof r.error?r.error:"object"==typeof r.error&&null!==r.error&&"message"in r.error?String(r.error.message||"WebSocket open timeout"):"WebSocket open timeout";m("[WS] Open timeout:",e),G(e),Y("error"),q.current=!1}},(e,r,a)=>{c(`[WS] close handler: code=${e}, reason=${r}, wasClean=${a}`),Q.current=null,q.current=!1;let s=t?.status;if(V.current&&"playing"===s&&!a){let e=[500,1e3,2e3,4e3,8e3],r=async a=>{let s=t?.status,n=t?.id;if(!V.current||"playing"!==s||!n){Y("disconnected");return}if(a>10){Y("disconnected"),G("Failed to reconnect after 10 attempts"),c("[Reconnect] Max attempts reached, giving up");return}let l=Math.min(a-1,e.length-1),i=e[l];X.current=a,Y("reconnecting"),c(`[Reconnect] Attempt ${a} in ${i}ms`),setTimeout(async()=>{let e=t?.status,s=t?.id;if(!V.current||"playing"!==e||!s){Y("disconnected");return}if(Q.current){let e=Q.current.readyState;if(e===WebSocket.OPEN||e===WebSocket.CONNECTING){c("[Reconnect] Already connected/connecting, skipping");return}}await eJ(e,s),setTimeout(()=>{V.current&&t?.status==="playing"&&(!Q.current||Q.current.readyState!==WebSocket.OPEN)&&r(a+1)},i+1e3)},i)};r(1)}else Y("disconnected")},e=>{});Q.current=n}catch(r){let e=r instanceof Error?r.message:"Failed to connect to game server";m("[AutoConnect] Connection error:",r),G(e),Y("error"),Q.current=null,q.current=!1}},[]),eH=(0,s.useCallback)(r=>{if(!e||!Q.current||Q.current.readyState!==WebSocket.OPEN)return u("[READY] Cannot send READY: WS not connected"),!1;try{return c("[READY] Sending READY message"),Q.current.send(JSON.stringify({type:"READY",roomId:e,isReady:r})),!0}catch(e){return m("[READY] Failed to send READY message:",e),!1}},[e]),eB=(0,s.useCallback)(r=>{if(!e||!Q.current||Q.current.readyState!==WebSocket.OPEN)return u("[PLAY] Cannot send PLAY: WS not connected"),!1;try{return c("[PLAY] Sending PLAY message"),Q.current.send(JSON.stringify({type:"PLAY",roomId:e,cards:r})),eR(null),eo(r),ed.current=r,es(e=>{if(!e)return e;let t=e.filter(e=>!r.some(r=>f(r,e)));return t=h(t),el(t=>{if(0===t.length)return[];let a=new Set(r.map(r=>e.findIndex(e=>f(e,r))).filter(e=>-1!==e));return t.filter(e=>!a.has(e)).map(e=>{let r=Array.from(a).filter(r=>r<e).length;return e-r})}),t}),eb([]),!0}catch(e){return m("[PLAY] Failed to send PLAY message:",e),eR("Failed to send play message"),!1}},[e]),eK=(0,s.useCallback)(r=>{if(!e||!Q.current||Q.current.readyState!==WebSocket.OPEN)return u("[SET_RULES] Cannot send SET_RULES: WS not connected"),!1;try{return c("[SET_RULES] Sending SET_RULES message"),Q.current.send(JSON.stringify({type:"SET_RULES",roomId:e,scoreLimit:r})),eR(null),!0}catch(e){return m("[SET_RULES] Failed to send SET_RULES message:",e),eR("Failed to set rules"),!1}},[e]),eV=(0,s.useCallback)(()=>{if(!e||!Q.current||Q.current.readyState!==WebSocket.OPEN)return u("[PASS] Cannot send PASS: WS not connected"),!1;try{return c("[PASS] Sending PASS message"),Q.current.send(JSON.stringify({type:"PASS",roomId:e})),eR(null),!0}catch(e){return m("[PASS] Failed to send PASS message:",e),eR("Failed to send pass message"),!1}},[e]),eX=e=>{eb(r=>r.some(r=>r.rank===e.rank&&r.suit===e.suit)?r.filter(r=>!(r.rank===e.rank&&r.suit===e.suit)):r.length>=5?r:[...r,e])},eZ=ev===g,e0=async()=>{if(e&&g&&!A){if("connected"===M&&Q.current?.readyState===WebSocket.OPEN){let e=Z.find(e=>e.playerId===g),r=i.find(e=>e.player_id===g),t=e?e.isReady:r?.is_ready??!1;O(!0),eH(!t)||P("Failed to send ready status. Please try again."),O(!1);return}O(!0);try{let r=i.find(e=>e.player_id===g);if(!r)return;let{error:t}=await d.from("room_players").update({is_ready:!r.is_ready}).eq("room_id",e).eq("player_id",g);if(t)throw t}catch(e){e instanceof Error&&P(e.message)}finally{O(!1)}}},e1=async()=>{if(e&&g&&!W){L(!0);try{if(V.current=!1,Q.current){let e=Q.current;e.markManualClose&&e.markManualClose(),Q.current.close(),Q.current=null}q.current=!1,Y("disconnected");let{error:t}=await d.from("room_players").update({left_at:new Date().toISOString()}).eq("room_id",e).eq("player_id",g);if(t)throw t;r("/lobby")}catch(e){e instanceof Error&&P(e.message)}finally{L(!1)}}},e2=async r=>{if(r?.preventDefault(),c("[Start] clicked"),U){c("[Start] Already starting, ignoring duplicate click");return}if(!e||!g){c("[Start] Missing roomId or currentUserId",{roomId:e,currentUserId:g}),P("Missing room ID or user ID");return}c("[Start] roomId",e),D(!0);try{let{data:{session:r}}=await d.auth.getSession(),t=!!r?.access_token;if(c("[Start] session token present?",t),!r?.access_token){P("No access token available. Please log in again."),G("No access token available");return}let{data:a,error:s}=await d.from("rooms").select("id, owner_id, status").eq("id",e).single();if(s||!a){let e=s?.message||"Room not found";m("[Start] room fetch error:",s),P(`Failed to fetch room: ${e}`),G(`Failed to fetch room: ${e}`);return}if(g!==a.owner_id){let e="Only the room owner can start the game";c("[Start] Ownership check failed",{currentUserId:g,ownerId:a.owner_id}),P(e),G(e);return}if("playing"===a.status){c("[Start] Room already playing, skipping PATCH"),D(!1);return}c("[Start] Patching rooms.status to 'playing'");let{error:n}=await d.from("rooms").update({status:"playing"}).eq("id",e);if(n){let e={status:n?.status||"unknown",message:n.message||"Unknown error",details:n?.details||null,hint:n?.hint||null};m("[Start] patch rooms.status result ERROR:",e);let r=`Failed to update room status: ${e.message}${e.hint?` (${e.hint})`:""}`;P(r),G(r),D(!1);return}c("[Start] patch rooms.status result SUCCESS");let l=setTimeout(()=>{D(!1)},5e3),i=setInterval(()=>{("connected"===M||"error"===M)&&(clearInterval(i),clearTimeout(l),D(!1))},100);setTimeout(()=>{clearInterval(i)},1e4)}catch(r){let e=r instanceof Error?r.message:"Failed to start game";m("[Start] Unexpected error:",r),P(e),G(e),D(!1)}},e4=async()=>{e&&g&&t&&(Q.current&&(Q.current.close(),Q.current=null),q.current=!1,await eJ(t.status,t.id))};if(S)return a.jsx(I,{children:a.jsx("div",{className:"flex items-center justify-center min-h-[60vh]",children:(0,a.jsxs)("div",{className:"space-y-4 w-full max-w-md",children:[a.jsx(T,{className:"h-12 w-full"}),a.jsx(T,{className:"h-10 w-3/4"}),a.jsx(T,{className:"h-10 w-full"})]})})});if(_||!t)return a.jsx(I,{children:a.jsx("div",{className:"space-y-4",children:a.jsx(k,{children:(0,a.jsxs)("div",{className:"p-6 text-center space-y-4",children:[a.jsx("p",{className:"text-[var(--danger)]",children:_||"Room not found"}),a.jsx(R,{onClick:()=>r("/lobby"),children:"Back to Lobby"})]})})})});let e3=i.find(e=>e.player_id===g),e5=g===t.owner_id;return a.jsx(I,{title:`Room: ${t.code}`,subtitle:`Score Limit: ${eO}`,showSignOut:!1,children:(0,a.jsxs)("div",{className:"space-y-6",children:[a.jsx("div",{className:"flex justify-end",children:a.jsx(R,{variant:"danger",onClick:e1,disabled:W,isLoading:W,children:"Leave Room"})}),_&&a.jsx("div",{className:"p-4 bg-[var(--danger-bg)] border border-[var(--danger)] text-[var(--danger)] rounded-lg",children:_}),er&&a.jsx("div",{className:"p-4 bg-[var(--success)] text-white rounded-lg shadow-md",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[a.jsx("strong",{className:"text-lg",children:"Round starting..."}),a.jsx("span",{className:"text-sm opacity-90",children:new Date(er.startedAt).toLocaleString()})]})}),ea&&a.jsx("div",{className:"p-4 bg-[var(--info)] text-white rounded-lg shadow-md text-center font-semibold",children:"Cards dealt. Waiting for starter..."}),!1,a.jsx(k,{children:(0,a.jsxs)(k,{header:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[a.jsx("h3",{className:"text-base font-semibold text-[var(--text)]",children:"Game Server Connection"}),(0,a.jsxs)(v,{variant:"connected"===M?"success":"connecting"===M||"reconnecting"===M?"warning":"error"===M?"danger":"default",children:["connected"===M&&"● Connected","connecting"===M&&"● Connecting...","reconnecting"===M&&`● Reconnecting (${X.current}/10)...`,"error"===M&&"● Error","disconnected"===M&&"○ Disconnected"]})]}),children:[$&&a.jsx("div",{className:"mb-4 p-3 bg-[var(--danger-bg)] border border-[var(--danger)] text-[var(--danger)] rounded-lg text-sm",children:$}),!1,"disconnected"===M&&t?.status==="playing"&&a.jsx(R,{size:"sm",onClick:e4,children:"Reconnect"}),!1,!1]})}),a.jsx(k,{children:a.jsx(k,{header:(0,a.jsxs)("h2",{className:"text-lg font-semibold text-[var(--text)]",children:["Players (",Z.length>0?Z.length:i.length,")"]}),children:a.jsx("div",{className:"space-y-3",children:(()=>{let e=i.map(e=>{let r=Z.find(r=>r.playerId===e.player_id);return{playerId:e.player_id,isReady:r?.isReady??e.is_ready,displayName:e.profile?.display_name||null}});return(Z.length>0&&Z.forEach(r=>{e.find(e=>e.playerId===r.playerId)||e.push({playerId:r.playerId,isReady:r.isReady,displayName:null})}),0===e.length)?a.jsx("p",{className:"text-center text-[var(--text-muted)] py-8",children:"No players in room"}):e.map(e=>{let r=e.playerId===g,s=eP.includes(e.playerId),n=e.playerId===ev,l=e.displayName||eG(e.playerId);return(0,a.jsxs)("div",{className:b("flex justify-between items-center p-4 rounded-lg border transition-all",r&&"bg-[var(--primary-bg)] border-[var(--primary)]",n&&"bg-[var(--warning-bg)] border-[var(--warning)]",!r&&!n&&"bg-[var(--bg-elevated)] border-[var(--border)] hover:bg-[var(--surface-hover)]"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[a.jsx("span",{className:"font-medium text-[var(--text)]",children:l}),e5&&e.playerId===t.owner_id&&a.jsx(v,{variant:"warning",size:"sm",children:"Owner"}),s&&a.jsx(v,{variant:"default",size:"sm",children:"Passed"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[e.isReady?a.jsx(v,{variant:"success",size:"sm",children:"✓ Ready"}):a.jsx("span",{className:"text-sm text-[var(--text-muted)]",children:"Not Ready"}),n&&a.jsx(v,{variant:"warning",size:"sm",children:"• Your Turn"})]})]},e.playerId)})})()})})}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 items-center justify-center",children:[g&&(()=>{let e=Z.find(e=>e.playerId===g),r=e?e.isReady:e3?.is_ready??!1,t=A||"connected"!==M||!!er;return a.jsx(R,{onClick:e0,variant:r?"success":"secondary",disabled:t,isLoading:A,title:"connected"!==M?"Connect first":er?"Round already started":"",children:"connected"!==M?"Connect first":er?"Round started":r?"Mark Not Ready":"Mark Ready"})})(),e5&&"playing"!==t.status&&!er&&(0,a.jsxs)("div",{className:"flex items-center gap-3 p-4 bg-[var(--bg-elevated)] rounded-lg border border-[var(--border)]",children:[a.jsx("label",{htmlFor:"scoreLimit",className:"text-sm font-medium text-[var(--text)]",children:"Score Limit (1-60):"}),a.jsx("input",{id:"scoreLimit",type:"number",min:"1",max:"60",value:eD,onChange:e=>eM(Math.min(60,Math.max(1,Number(e.target.value)||60))),className:"w-20 px-3 py-2 bg-[var(--bg-surface)] border border-[var(--border)] rounded-lg text-[var(--text)] focus:outline-none focus:ring-2 focus:ring-[var(--border-focus)]"}),a.jsx(R,{size:"sm",onClick:()=>{eD>=1&&eD<=60&&(eK(eD),C.success("Score limit updated"))},disabled:"connected"!==M||eD<1||eD>60,title:"connected"!==M?"WebSocket disconnected":"",children:"Set Rules"})]}),e5&&"playing"!==t.status&&!er&&a.jsx(R,{onClick:e2,disabled:U,isLoading:U,children:"Start Game"})]}),ea&&t?.status==="playing"&&(0,a.jsxs)("div",{className:"space-y-6",children:[eC&&a.jsx("div",{className:"p-4 bg-[var(--success)] text-white rounded-lg shadow-md text-center",children:(0,a.jsxs)("strong",{className:"text-lg",children:["Round ended. Winner: ",eC.winnerPlayerId]})}),eE&&a.jsx("div",{className:"p-3 bg-[var(--danger-bg)] border border-[var(--danger)] text-[var(--danger)] rounded-lg text-sm font-medium",children:eE}),(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row gap-6 justify-center",children:[a.jsx("div",{className:"flex-1 min-w-0",children:a.jsx(w,{seatedPlayerIds:ex,handsCount:ew,totalScores:eY,scoreLimit:eO,currentTurnPlayerId:ev,eliminated:ez,currentUserId:g,lastPlay:ej,playerNames:eQ,playerAvatars:eq})}),a.jsx("div",{className:"lg:w-80",children:a.jsx(E,{queuePlayerIds:ey,seatedPlayerIds:ex,handsCount:ew,totalScores:eY,scoreLimit:eO,currentTurnPlayerId:ev,eliminated:ez,playerNames:eQ})})]}),a.jsx(k,{children:(0,a.jsxs)("div",{className:"space-y-5",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("h3",{className:"text-lg font-heading font-bold text-cyan-300 text-glow-cyan",children:["Your Hand (",ea.length," cards)",ef.length>0&&(0,a.jsxs)("span",{className:"ml-2 text-sm text-lime-400 text-glow-lime font-medium",children:["• Selected: ",ef.length,"/5"]})]}),en.length>0&&a.jsx(R,{onClick:()=>el([]),variant:"secondary",size:"sm",title:"Sort cards by rank and suit",children:"Sort"})]}),a.jsx("div",{className:"flex flex-wrap gap-3 justify-center",children:(en.length>0&&en.length===ea.length?en.map(e=>ea[e]).filter(Boolean):h(ea)).map(e=>{let r=ef.some(r=>f(r,e)),t=ea.findIndex(r=>f(r,e));return a.jsx("div",{draggable:!0,onDragStart:e=>{e.dataTransfer.setData("cardIndex",String(t)),e.dataTransfer.effectAllowed="move"},onDragOver:e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},onDrop:e=>{e.preventDefault();let r=parseInt(e.dataTransfer.getData("cardIndex"),10);r!==t&&el(e=>{if(0===e.length)return ea.map((e,r)=>r);let a=[...e],s=a.indexOf(r),n=a.indexOf(t);return a.splice(s,1),a.splice(n,0,r),a})},className:"cursor-move transition-transform duration-200 hover:scale-110",children:a.jsx(N,{card:e,isSelected:r,onClick:()=>eX(e),size:"md"})},`${e.rank}-${e.suit}-${t}`)})})]}),!eC&&(0,a.jsxs)("div",{className:"flex gap-4 justify-center pt-2",children:[(0,a.jsxs)(R,{onClick:()=>{[1,2,3,5].includes(ef.length)&&eB(ef)},variant:"success",disabled:![1,2,3,5].includes(ef.length)||!eZ||"connected"!==M,title:"connected"!==M?"WebSocket disconnected":eZ?0===ef.length?"Select 1, 2, 3, or 5 cards to play":4===ef.length?"4 cards not allowed. Select 1, 2, 3, or 5 cards":ef.length>5?"Maximum 5 cards allowed":"":"Not your turn",children:["PLAY ",ef.length>0&&`(${ef.length})`]}),a.jsx(R,{onClick:()=>{eV()},variant:"warning",disabled:!eZ||!ej||"connected"!==M,title:"connected"!==M?"WebSocket disconnected":eZ?ej?"":"You must start the trick":"Not your turn",children:"PASS"})]})]})})]})]})})}function W(){return a.jsx(O,{})}},6536:(e,r,t)=>{"use strict";t.d(r,{AppProviders:()=>c});var a=t(326),s=t(2852),n=t(8314),l=t(7577),i=t(1899);class o extends l.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,r){console.error("ErrorBoundary caught an error:",e,r)}render(){return this.state.hasError?a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-[var(--bg)] p-4",children:(0,a.jsxs)("div",{className:"glass-lg rounded-xl border border-white/10 p-8 max-w-md w-full text-center",children:[(0,a.jsxs)("div",{className:"mb-6",children:[a.jsx("div",{className:"w-16 h-16 rounded-full border-2 border-pink-500/50 flex items-center justify-center mx-auto mb-4",children:a.jsx("span",{className:"text-4xl",children:"⚠️"})}),a.jsx("h1",{className:"text-2xl font-heading font-bold text-pink-300 mb-2",children:"Something went wrong"}),a.jsx("p",{className:"text-cyan-400/70 text-sm mb-4",children:this.state.error?.message||"An unexpected error occurred"})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[a.jsx(i.z,{variant:"primary",onClick:()=>{this.setState({hasError:!1,error:null}),window.location.reload()},className:"w-full",children:"Reload Application"}),a.jsx(i.z,{variant:"ghost",onClick:()=>{window.location.href="/lobby"},className:"w-full",children:"Go to Lobby"})]})]})}):this.props.children}}let d=new s.S({defaultOptions:{queries:{staleTime:3e5,gcTime:6e5,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!0,retry:1},mutations:{retry:1}}});function c({children:e}){return a.jsx(o,{children:a.jsx(n.aH,{client:d,children:a.jsx(l.Suspense,{fallback:a.jsx(u,{}),children:e})})})}function u(){return a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-[var(--bg)] p-4",children:(0,a.jsxs)("div",{className:"text-center max-w-md w-full",children:[a.jsx("div",{className:"inline-block animate-spin rounded-full h-14 w-14 border-3 border-cyan-400 border-t-transparent mb-6"}),a.jsx("p",{className:"text-cyan-400/70 font-heading font-medium text-lg mb-8",children:"Loading CyberPoker..."}),(0,a.jsxs)("div",{className:"space-y-4",children:[a.jsx("div",{className:"h-12 w-full bg-cyan-900/20 rounded-lg border border-cyan-400/10 animate-pulse"}),a.jsx("div",{className:"h-10 w-3/4 mx-auto bg-cyan-900/20 rounded-lg border border-cyan-400/10 animate-pulse"}),a.jsx("div",{className:"h-10 w-full bg-cyan-900/20 rounded-lg border border-cyan-400/10 animate-pulse"})]})]})})}},9065:(e,r,t)=>{"use strict";t.d(r,{UO:()=>l,s0:()=>n});var a=t(5047),s=t(7577);function n(){let e=(0,a.useRouter)();return(r,t)=>{t?.replace?e.replace(r):e.push(r)}}function l(){let e=(0,a.useParams)();return(0,s.useMemo)(()=>{let r={};return e&&Object.entries(e).forEach(([e,t])=>{r[e]=Array.isArray(t)?t[0]:t}),r},[e])}},1899:(e,r,t)=>{"use strict";t.d(r,{z:()=>l});var a=t(326),s=t(7577),n=t(97);let l=(0,s.forwardRef)(({className:e,variant:r="primary",size:t="md",isLoading:s,children:l,disabled:i,...o},d)=>(0,a.jsxs)("button",{ref:d,className:(0,n.cn)("inline-flex items-center justify-center font-heading font-semibold transition-all duration-300 rounded-lg focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-offset-cyber-bg focus-visible:ring-cyan-400 disabled:opacity-50 disabled:cursor-not-allowed relative overflow-hidden",{primary:"glass border-2 border-cyan-400/60 text-cyan-300 hover:border-cyan-400 hover:text-cyan-200 hover:shadow-glow-cyan active:scale-95",secondary:"glass border-2 border-cyan-500/40 text-white hover:border-cyan-400/60 hover:shadow-neon-cyan active:scale-95",ghost:"text-cyan-400 hover:text-cyan-300 hover:bg-cyan-900/20 border border-transparent hover:border-cyan-400/30 active:scale-95",danger:"glass border-2 border-pink-500/60 text-pink-300 hover:border-pink-400 hover:text-pink-200 hover:shadow-glow-magenta active:scale-95",success:"glass border-2 border-lime-400/60 text-lime-300 hover:border-lime-400 hover:text-lime-200 hover:shadow-glow-lime active:scale-95",warning:"glass border-2 border-purple-400/60 text-purple-300 hover:border-purple-400 hover:text-purple-200 hover:shadow-glow-purple active:scale-95"}[r],{sm:"px-3 py-1.5 text-xs h-8",md:"px-4 py-2 text-sm h-10",lg:"px-6 py-3 text-base h-12"}[t],e),disabled:i||s,...o,children:[a.jsx("div",{className:"absolute inset-0 opacity-0 hover:opacity-100 transition-opacity duration-300",children:a.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-cyan-400/20 to-transparent transform -skew-x-12 animate-scanline"})}),a.jsx("span",{className:"relative z-10",children:s?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 inline",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[a.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),a.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Loading..."]}):l})]}));l.displayName="Button"},7087:(e,r,t)=>{"use strict";t.d(r,{A:()=>u,ToastContainer:()=>m});var a=t(326),s=t(7577),n=t(97);function l({toast:e,onRemove:r}){let[t,l]=(0,s.useState)(!1);return a.jsx("div",{className:(0,n.cn)("px-4 py-3 rounded-lg border shadow-lg backdrop-blur-sm","transition-all duration-300 ease-in-out",{success:"bg-[var(--success-bg)] border-[var(--success)] text-[var(--success)]",error:"bg-[var(--danger-bg)] border-[var(--danger)] text-[var(--danger)]",info:"bg-[var(--info-bg)] border-[var(--info)] text-[var(--info)]",warning:"bg-[var(--warning-bg)] border-[var(--warning)] text-[var(--warning)]"}[e.type||"info"],t?"opacity-0 translate-x-full":"opacity-100 translate-x-0"),children:a.jsx("div",{className:"flex items-center gap-2",children:a.jsx("span",{className:"font-medium",children:e.message})})})}let i=0,o=[],d=[];function c(){d.forEach(e=>e([...o]))}let u={show:(e,r="info",t)=>{let a=`toast-${++i}`;return o.push({id:a,message:e,type:r,duration:t}),c(),a},success:(e,r)=>u.show(e,"success",r),error:(e,r)=>u.show(e,"error",r),info:(e,r)=>u.show(e,"info",r),warning:(e,r)=>u.show(e,"warning",r)};function m(){let[e,r]=(0,s.useState)([]),t=e=>{let r=o.findIndex(r=>r.id===e);r>-1&&(o.splice(r,1),c())};return 0===e.length?null:a.jsx("div",{className:"fixed top-4 right-4 z-[var(--z-toast)] flex flex-col gap-2 max-w-sm",children:e.map(e=>a.jsx(l,{toast:e,onRemove:t},e.id))})}},97:(e,r,t)=>{"use strict";function a(...e){return e.filter(Boolean).join(" ")}t.d(r,{cn:()=>a})},5804:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>x,metadata:()=>p});var a=t(9510),s=t(272),n=t.n(s),l=t(3774),i=t.n(l),o=t(6816),d=t.n(o),c=t(8570);let u=(0,c.createProxy)(String.raw`/Users/bayartsogtbts/Desktop/Gerege Agent AI/Pp/poker_frontend/src/app/providers.tsx#AppProviders`);(0,c.createProxy)(String.raw`/Users/bayartsogtbts/Desktop/Gerege Agent AI/Pp/poker_frontend/src/shared/components/ui/Toast.tsx#toast`);let m=(0,c.createProxy)(String.raw`/Users/bayartsogtbts/Desktop/Gerege Agent AI/Pp/poker_frontend/src/shared/components/ui/Toast.tsx#ToastContainer`);t(1141);let p={title:"CyberPoker",description:"Premium Cyberpunk Poker Game",icons:{icon:"/favicon.ico"}};function x({children:e}){return a.jsx("html",{lang:"en",className:`${n().variable} ${i().variable} ${d().variable}`,children:a.jsx("body",{children:(0,a.jsxs)(u,{children:[e,a.jsx(m,{})]})})})}},4401:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>a});let a=(0,t(8570).createProxy)(String.raw`/Users/bayartsogtbts/Desktop/Gerege Agent AI/Pp/poker_frontend/app/room/[roomId]/page.tsx#default`)},1141:()=>{}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[644,450],()=>t(6422));module.exports=a})();